import{s as O,u as Y,m as n,n as Z,B as ee}from"./poke-Ce9VKroT.js";import{s as te,a as ae}from"./index-CnshtUVL.js";import{d as X,f as z,h as H,o as c,w as u,a as Q,b as a,U,u as e,e as o,t as r,L as ne,i as se,N as le,r as d,V as W,W as ie,c as y,D as b,F as E,g as oe,Q as j,X as ue}from"./index-DMeQVgSp.js";import{s as re}from"./index-C-yNGsBY.js";import{s as T}from"./index-c4tnXFvj.js";import{s as k}from"./index-D_B0SnMf.js";const pe=["src","alt"],ce={name:"SplitterPanel"},F=X({...ce,props:{sprite:{},name:{},hp:{},maxHp:{},enemy:{type:Boolean}},setup(L){const x=L,l=z(()=>Math.floor(x.hp/x.maxHp*100));return(f,m)=>(c(),H(e(te),{style:U(f.enemy?"text-align: right":"")},{default:u(()=>[Q("img",{src:f.sprite,alt:f.name,style:U(f.enemy?"":"transform: scaleX(-1)"),onLoad:m[0]||(m[0]=h=>f.$emit("sprite"))},null,44,pe),a(e(O),{value:l.value},{default:u(()=>[o("HP: "+r(f.hp)+" ("+r(l.value)+"%)",1)]),_:1},8,["value"])]),_:1},8,["style"]))}}),me={key:0},fe={key:1,style:{display:"flex","justify-content":"space-around"}},de={key:2},xe=X({__name:"PokeBattle",setup(L){const x=ne(),l=Y(),f=se(),m=le(),h=d(0),v=d({}),_=d(0),V=d(!1),$=W([]),M=d(!0);let t;const B=d(!1),N=d(!1),P=W([]);let C;const g=d(null);let S=10;const A=z(()=>g.value!=null);function q(){h.value=l.hp}function G(){_.value=v.value.stats.hp}async function w(p){return B.value=!0,new Promise(s=>{C=setTimeout(()=>{p(),B.value=!1,s(1)},1e3)})}function R(){if(h.value<=0)return g.value=!1,S/=2,!0;if(_.value<=0)return g.value=!0,!0}function D(){N.value=!0;const p=P[0];C=setTimeout(async()=>{t.ailment.skip>0?await w(()=>{t.ailment.skip--,m.add({detail:"턴 생략 적용⏰",life:2e3})}):(P.push(...P.splice(0,1)),await p.select(t.ailment.infatuation?_:h)),t.ailment.infatuation>0&&t.ailment.infatuation--,!R()&&(M.value=!0,n.ailment.defenseless>0&&n.ailment.defenseless--,n.ailment.dot.length&&await w(()=>{n.ailment.dot[0](),m.add({detail:"지속 피해 적용🔥",life:2e3}),n.ailment.dot.shift()}),n.ailment.skip>0&&(await w(()=>{n.ailment.skip--,m.add({detail:"턴 생략 적용⏰",life:2e3})}),M.value=!1,t.ailment.dot.length&&await w(()=>{t.ailment.dot[0](),m.add({detail:"지속 피해 적용🔥",life:2e3}),t.ailment.dot.shift()}),D()))},1e3)}async function I(p){S++,await p.select(n.ailment.infatuation?h:_),p.used=!0,$.map(i=>i.used).every(i=>i)&&$.forEach(i=>i.used=!1),n.ailment.infatuation>0&&n.ailment.infatuation--,!R()&&(M.value=!1,t.ailment.defenseless>0&&t.ailment.defenseless--,t.ailment.dot.length&&await w(()=>{t.ailment.dot[0](),m.add({detail:"지속 피해 적용🔥",life:2e3}),t.ailment.dot.shift()}),D())}function J(){l.earnExp(S),x.back()}return n.init(),f.load("getPokelist").setWhenSuccess(async p=>{await Z(p.results[Math.floor(Math.random()*p.results.length)].url,v.value),t=new ee(v.value,()=>l.level,m),$.push(...n.getMoveList(t)),P.push(...t.getMoveList(n)),V.value=!0}).fire(),ie(()=>clearTimeout(C)),(p,i)=>(c(),y("main",null,[a(e(T),null,{title:u(()=>[o(r(e(l).name)+" ",1),a(e(re),{style:{display:"inline-block"}},{default:u(()=>i[1]||(i[1]=[o("VS")])),_:1,__:[1]}),o(" "+r(v.value.ko+" Lv "+e(l).level),1)]),content:u(()=>[V.value?(c(),H(e(ae),{key:0},{default:u(()=>[a(F,{sprite:e(l).sprite,name:e(l).name,hp:h.value,"max-hp":e(l).hp,onSprite:q},null,8,["sprite","name","hp","max-hp"]),a(F,{sprite:v.value.sprites,name:v.value.ko,hp:_.value,"max-hp":v.value.stats.hp,enemy:"",onSprite:G},null,8,["sprite","name","hp","max-hp"])]),_:1})):b("",!0)]),_:1}),a(e(k)),a(e(T),null,{content:u(()=>[B.value?(c(),y("span",me,"지속 피해 계산중..")):M.value?(c(),y("div",fe,[(c(!0),y(E,null,oe($,(s,K)=>(c(),H(e(j),{key:K,variant:"outlined",disabled:s.used,onClick:ve=>I(s)},{default:u(()=>[Q("div",null,[o(r(s.ko)+" ",1),a(e(k)),o(" "+r(s.category)+" ",1),a(e(k)),o(" 성공률: "+r(s.expectRate)+"% ",1),s.category.includes("damage")?(c(),y(E,{key:0},[a(e(k)),o(" 예상 데미지: "+r(e(n).getDamage(e(t),e(t).ailment.defenseless)),1)],64)):b("",!0),s.expectEffect?(c(),y(E,{key:1},[a(e(k)),o(" 효과: "+r(s.expectEffect),1)],64)):b("",!0)])]),_:2},1032,["disabled","onClick"]))),128))])):N.value?(c(),y("span",de,"Action 선택중..")):b("",!0)]),_:1}),a(e(ue),{visible:A.value,"onUpdate:visible":i[0]||(i[0]=s=>A.value=s),modal:"",header:g.value?"승리✌":"패배😑"},{container:u(()=>[a(e(T),null,{title:u(()=>[o(r(g.value?"승리✌":"패배😑"),1)]),content:u(()=>[o(" 얻은 경험치: "+r(e(S))+" ",1),a(e(k)),a(e(j),{icon:"pi pi-check",onClick:J})]),_:1})]),_:1},8,["visible","header"])]))}});export{xe as default};
